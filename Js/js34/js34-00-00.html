<!DOCTYPE html>
<html lang="en">
<head>
    <title>문제 끝판왕</title>
    <script>
        /* 
        각자의 todo list를 localStorage에 저장할 수 있도록 만들어라!!
         */


         /* todo-list */
         document.addEventListener("DOMContentLoaded",()=>{
             const h1 = document.createElement("h1");
             const input = document.createElement("input");
             const button = document.createElement("button");
             const div = document.createElement("div");
             
             document.body.append(h1, input, button, div);
             
             input.setAttribute("id","todo");
             button.setAttribute("id","add-button");
             div.setAttribute("id","todo-list");
             h1.innerHTML = '할 일 목록';
             button.innerHTML = '추가하기';


             let arr = [];
             /* 키 */
            //  let key = 0;
            /* //키 */
             
             function auto(){
                 const checkbox = document.createElement("input");
                 const write = document.createElement('span');
                 const clearButton = document.createElement("button");
                 const br = document.createElement("br");

                 /* 키 */
                //  const kEy = key;
                /* //키 */

                 input.value!=0?document.body.append(checkbox,write,clearButton,br):alert('다시 입력하세요.');
                 
                 /* 키 */
                //  write.setAttribute("data-key",kEy);
                /* //키 */
                 checkbox.setAttribute("type","checkbox");
                 write.innerHTML = input.value;
                 clearButton.innerHTML = '제거하기';

                 arr.push(input.value);
                 console.log(arr);
                 localStorage.setItem("update",arr);
                
                function removing(){
                    /* 키 */
                    // arr.splice(arr.indexOf(document.querySelector(`[data-key="${kEy}"]`).innerHTML),1);
                    // console.log(document.querySelector(`[data-key="${kEy}"]`));
                    /* //키 */

                    /* 키NO */
                    // arr.splice(arr.indexOf(write.innerHTML),1);
                    /* //키NO. indexOf의 특성으로 문제 발생. */
                    
                    // arr=arr.filter((v,i)=>{
                    //     return (arr.indexOf(write.innerHTML)!=i||v!=write.innerHTML)!=(arr.indexOf(write.innerHTML)==i&&v!=write.innerHTML);
                    // })
                    arr=arr.filter((v,i)=>{
                        return v==write.innerHTML?;
                    })
                    
                    document.body.removeChild(checkbox);
                    document.body.removeChild(write);
                    document.body.removeChild(clearButton);
                    document.body.removeChild(br);
                    
                    console.log(arr);
                    localStorage.setItem("update",arr);
                }
                
                checkbox.addEventListener("change",(event)=>{
                    let state = event.currentTarget.checked;
                    write.style.textDecoration=state?"line-through":"";
                    state?clearButton.addEventListener("click",removing):clearButton.removeEventListener("click",removing);
                })
                /* 키 */
                // key++;
                /* //키 */
            }
            button.addEventListener("click",auto);
            /* //todo-list */
        })
        </script>
</head>
<body>
    
</body>
</html>